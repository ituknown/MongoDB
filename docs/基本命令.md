### 列出所有数据库

```
show dbs

---
admin    0.000GB
config   0.000GB
local    0.000GB
```

### 使用或创建数据库

````
use <db>

---
use admin

switched to db admin
````

`use` 命令是使用指定数据库命令，不过如果指定的 `db` 在数据库中不存在则会进行创建：

```
show dbs

---
admin    0.000GB
config   0.000GB
local    0.000GB

# 创建数据库 itumate
use itumate

switched to db itumate
```

现在虽然切换后到 `itumate` 但是由于还没有增加任何数据，所以当退出时该数据库并不会进行创建，我们需要增加集合和数据：

```
db.<collection_name>.<command>

# 新增 user_log 表
db.user_log.insert({name: "MinGRn", age: 18, email: "MinGRn97@gmail.com"})
```

在执行这条命令时首先会判断数据库 `itumate` 是否存在，不存在则进行创建。继续判断 `user_log` 集合是否存在，如果不存在则同样进行创建。创建完成后继而增加数据，现在进行查询：

```
db.user_log.find()

---
{ "_id" : ObjectId("5d2ea45fc4ab19ee1ff6d7a0"), "name" : "MinGRn", "age" : 18, "email" : "MinGRn97@gmail.com" }
```

另外，如果想要输出更加美观可以使用 `pretty` 参数：

```
db.user_log.find().pretty()

---
{
	"_id" : ObjectId("5d2ea45fc4ab19ee1ff6d7a0"),
	"name" : "MinGRn",
	"age" : 18,
	"email" : "MinGRn97@gmail.com"
}
```

现在应增加了数据，再次查询数据库：

```
show dbs

---
admin    0.000GB
config   0.000GB
itumate  0.000GB   # 该库已创建
local    0.000GB
```

### 列出数据库下所有表（集合）

```
show tables
  或
show collections

---
user_log
```

### 新增命令

新增命令有多条指令，如下所示：

```
# 新增一条
db.user_log.insertOne({}) 

# 新增多条
db.user_log.insertMany([])  

# 复合指令
db.user_log.insert({}|[]) 
```

下面来具体看下：

#### 新增一条数据

```
db.<collection_name>.insertOne({})
```

`insertOne` 接受文档数据，即 `JSON` 格式数据，现在来新增一条数据：

```
db.user_log.insertOne({name: "张三", username: "zhanssan"})
```

#### 新增多数数据

```
db.<collection_name>.insertMany([])
```

`insertMany` 接受数组文档数据，如下示例：

```
db.user_log.insertMany([{name: "王二", username: "wanger"},{name: "李四", username: "lisi"}])
```

#### 复合命令

```
db.<collection_name>.insert({}|[])
```

`insert` 命令是 `insertOne` 和 `insertMany` 的复合指令，该指令接受一条文档或者文档集合，如下示例：

```
# 接受一条文档数据
db.user_log.insert({name: "张三", username: "zhanssan"})

# 接受文档集合
db.user_log.insert([{name: "王二", username: "wanger"},{name: "李四", username: "lisi"}])
```

### 查询命令

数据查询可以使用如下两个命令：

```
# 直接使用 collection_name
db.<collection_name>.find({})

# 利用 getCollection('<collcetion_name>')
db.getCollection('<collcetion_name>').find({})
```

两个命令的 `find` 指令是相同的，后面以 `find` 做说明，

`find` 指令如下所示：

```
db.<collection_name>.find({})
```

先看下现有的数据：

```
db.user_log.find({})

---
{ "_id" : ObjectId("..."), "name" : "MinGRn", "age" : 18, "email" : "MinGRn97@gmail.com" }
{ "_id" : ObjectId("..."), "name" : "张三", "username" : "zhanssan" }
{ "_id" : ObjectId("..."), "name" : "张三", "username" : "zhanssan" }
{ "_id" : ObjectId("..."), "name" : "王二", "username" : "wanger" }
{ "_id" : ObjectId("..."), "name" : "李四", "username" : "lisi" }
{ "_id" : ObjectId("..."), "name" : "张三1", "username" : "zhanssan" }
{ "_id" : ObjectId("..."), "name" : "张三1", "username" : "zhanssan", "age" : 20 }
{ "_id" : ObjectId("..."), "name" : "张三2", "username" : "zhanssan", "age" : 22 }
```

#### 指定名称查询

- 查询名称（`name`）叫 `张三` 的用户：

```
db.user_log.find({name: "张三"})

---
{ "_id" : ObjectId("..."), "name" : "张三", "username" : "zhanssan" }
{ "_id" : ObjectId("..."), "name" : "张三", "username" : "zhanssan" }
```

#### 模糊查询

- 查询名称（`name`）包含 `张三` 的用户，即模糊查询：

```
db.user_log.find({name: /张三/})

---
{ "_id" : ObjectId("..."), "name" : "张三", "username" : "zhanssan" }
{ "_id" : ObjectId("..."), "name" : "张三", "username" : "zhanssan" }
{ "_id" : ObjectId("..."), "name" : "张三1", "username" : "zhanssan" }
{ "_id" : ObjectId("..."), "name" : "张三1", "username" : "zhanssan", "age" : 20 }
{ "_id" : ObjectId("..."), "name" : "张三2", "username" : "zhanssan", "age" : 22 }
```

- 查询名称（`name`）以 `张` 开头的用户

```
db.user_log.find({name: /^张三/})

---
{ "_id" : ObjectId("..."), "name" : "张三", "username" : "zhanssan" }
{ "_id" : ObjectId("..."), "name" : "张三", "username" : "zhanssan" }
{ "_id" : ObjectId("..."), "name" : "张三1", "username" : "zhanssan" }
{ "_id" : ObjectId("..."), "name" : "张三1", "username" : "zhanssan", "age" : 20 }
{ "_id" : ObjectId("..."), "name" : "张三2", "username" : "zhanssan", "age" : 22 }
```

- 查询名称（`name`）以 `三` 结尾的用户

```
db.user_log.find({name: /三$/})

---
{ "_id" : ObjectId("..."), "name" : "张三", "username" : "zhanssan" }
{ "_id" : ObjectId("..."), "name" : "张三", "username" : "zhanssan" }
```

#### 区间查询

- 查询年龄区间穿：

  - `$gt`：大于

  - `$gte`：大于等于

  - `$lt`：小于

  - `$lte`：小于等于

    - 查询年龄大于 18 的用户

    ```
    db.user_log.find({age: {$gt: 18}})
    
    ---
    { "_id" : ObjectId("..."), "name" : "张三1", "username" : "zhanssan", "age" : 20 }
    { "_id" : ObjectId("..."), "name" : "张三2", "username" : "zhanssan", "age" : 22 }
    ```

    - 查询年龄大于 18 且小于 22 的用户

    ```
    db.user_log.find({age: {$gt: 18, $lt: 22}})
    
    ---
    { "_id" : ObjectId("..."), "name" : "张三1", "username" : "zhanssan", "age" : 20 }
    ```

#### 或关系查询

或者关系查询使用指令 `$or`，如下所示：

```
db.<collection_name>.find({$or: []})
```

- 查询年龄为 20 和 20 的用户：

```
db.user_log.find({$or: [{age: 20}, {age: 22}]})

---
{ "_id" : ObjectId("..."), "name" : "张三1", "username" : "zhanssan", "age" : 20 }
{ "_id" : ObjectId("..."), "name" : "张三2", "username" : "zhanssan", "age" : 22 }
```



#### 联合查询

- 查询年龄（`age`）大于 18 且名称（`name`）以 `2` 结尾的用户：

```
db.user_log.find({age: {$gt: 18}, name: /2$/})

---
{ "_id" : ObjectId("..."), "name" : "张三2", "username" : "zhanssan", "age" : 22 }
```

#### 返回指定字段查询

`MongoDB` 条件查询指令一般如下：

```
db.<collection_name>.find({})
```

不过，如果想要返回指定列的字段怎办？

```
db.<collection_name>.find({}, {})
```

可以看到，现在在查询语句中多了一个选项，第二个选项就是要返回的字段！会与要返回的字段而言需要使用如下选项：

- 返回字段：
  - 等于 0 表示不返回
  - 大于 0 表示返回

  ---

- 返回名称字段（`name`）

```
db.user_log.find({},{name: 1})

---
{ "_id" : ObjectId("..."), "name" : "MinGRn" }
{ "_id" : ObjectId("..."), "name" : "张三" }
{ "_id" : ObjectId("..."), "name" : "张三" }
{ "_id" : ObjectId("..."), "name" : "王二" }
{ "_id" : ObjectId("..."), "name" : "李四" }
{ "_id" : ObjectId("..."), "name" : "张三1" }
{ "_id" : ObjectId("..."), "name" : "张三1" }
{ "_id" : ObjectId("..."), "name" : "张三2" }
```

- 不返回名称字段（`name`）

```
db.user_log.find({}, {name: 0})

---
{ "_id" : ObjectId("..."), "age" : 18, "email" : "MinGRn97@gmail.com" }
{ "_id" : ObjectId("..."), "username" : "zhanssan" }
{ "_id" : ObjectId("..."), "username" : "zhanssan" }
{ "_id" : ObjectId("..."), "username" : "wanger" }
{ "_id" : ObjectId("..."), "username" : "lisi" }
{ "_id" : ObjectId("..."), "username" : "zhanssan" }
{ "_id" : ObjectId("..."), "username" : "zhanssan", "age" : 20 }
{ "_id" : ObjectId("..."), "username" : "zhanssan", "age" : 22 }
```

#### 排序

排序使用 `sort` 指令，如下所示：

```
db.<collection_name>.find({}).sort({})
```

- `sort`：排序
  - ``-1`：降序
  - `1`：升序

  ----

- 按年龄降序

```
db.user_log.find({}).sort({age: -1})

---
{ "_id" : ObjectId("..."), "name" : "张三2", "username" : "zhanssan", "age" : 22 }
{ "_id" : ObjectId("..."), "name" : "张三1", "username" : "zhanssan", "age" : 20 }
{ "_id" : ObjectId("..."), "name" : "MinGRn", "age" : 18, "email" : "MinGRn97@gmail.com" }
{ "_id" : ObjectId("..."), "name" : "张三", "username" : "zhanssan" }
{ "_id" : ObjectId("..."), "name" : "张三", "username" : "zhanssan" }
{ "_id" : ObjectId("..."), "name" : "王二", "username" : "wanger" }
{ "_id" : ObjectId("..."), "name" : "李四", "username" : "lisi" }
{ "_id" : ObjectId("..."), "name" : "张三1", "username" : "zhanssan" }
```

- 按年龄升序

```
db.user_log.find({}).sort({age: 1})

---
{ "_id" : ObjectId("..."), "name" : "张三", "username" : "zhanssan" }
{ "_id" : ObjectId("..."), "name" : "张三", "username" : "zhanssan" }
{ "_id" : ObjectId("..."), "name" : "王二", "username" : "wanger" }
{ "_id" : ObjectId("..."), "name" : "李四", "username" : "lisi" }
{ "_id" : ObjectId("..."), "name" : "张三1", "username" : "zhanssan" }
{ "_id" : ObjectId("..."), "name" : "MinGRn", "age" : 18, "email" : "MinGRn97@gmail.com" }
{ "_id" : ObjectId("..."), "name" : "张三1", "username" : "zhanssan", "age" : 20 }
{ "_id" : ObjectId("..."), "name" : "张三2", "username" : "zhanssan", "age" : 22 }
```

#### 分页查询

分页查询可以使用 `limit` 和 `skip` 两个命令组合使用，其中 `limit` 单独使用表示查询 `N` 表数据，与 `skip` 复合使用则表示从第 `N` 条开始向下查询 `Y` 条数据，指令如下所示：

```
db.<collection_name>.find({}).limit(N).skip(Y)
```

我们先按照年龄降序查询全部数据：

```
db.user_log.find({}).sort({age: -1})

---
{ "_id" : ObjectId("..."), "name" : "张三2", "username" : "zhanssan", "age" : 22 }
{ "_id" : ObjectId("..."), "name" : "张三1", "username" : "zhanssan", "age" : 20 }
{ "_id" : ObjectId("..."), "name" : "MinGRn", "age" : 18, "email" : "MinGRn97@gmail.com" }
{ "_id" : ObjectId("..."), "name" : "张三", "username" : "zhanssan" }
{ "_id" : ObjectId("..."), "name" : "张三", "username" : "zhanssan" }
{ "_id" : ObjectId("..."), "name" : "王二", "username" : "wanger" }
{ "_id" : ObjectId("..."), "name" : "李四", "username" : "lisi" }
{ "_id" : ObjectId("..."), "name" : "张三1", "username" : "zhanssan" }
```

下面就利用这些数据进行查询操作：

- 按年龄降序查询前3条数据

```
db.user_log.find({}).sort({age: -1}).limit(3)

---
{ "_id" : ObjectId("..."), "name" : "张三2", "username" : "zhanssan", "age" : 22 }
{ "_id" : ObjectId("..."), "name" : "张三1", "username" : "zhanssan", "age" : 20 }
{ "_id" : ObjectId("..."), "name" : "MinGRn", "age" : 18, "email" : "MinGRn97@gmail.com" }
```

- 按年龄降序查询从第三条开始往后查询3条数据

```
db.user_log.find({}).sort({age: -1}).limit(3).skip(3)

---
{ "_id" : ObjectId("..."), "name" : "张三", "username" : "zhanssan" }
{ "_id" : ObjectId("..."), "name" : "张三", "username" : "zhanssan" }
{ "_id" : ObjectId("..."), "name" : "王二", "username" : "wanger" }
```

#### distinct 去重查询某列数据

`distinct` 指令同 `MySQL`，不同的是，只返回具体列的字段，如下所示：

```
db.user_log.distinct("name")

---
[ "MinGRn", "张三", "王二", "李四", "张三1", "张三2" ]
```

### 查询一条数据

查询一条数据命令与 [查询命令](#查询命令) 相同，只是查询指令不同：

```
db.<collection_name>.findOne({query}, {fields})
```

### 删除命令

删除命令有两种方式，如下所示：

```
db.<collection_name>.remove({query}, <juestOne ? true : false>)
  或
db.<collection_name>.remove({query}, {
  justOne: <boolean>,
  writeConcern: <document>
})
```

- `query` ：（可选）删除条件
- `justOne`：（可选）为 `true` 或 `1` 表示只删除一条数据
- `writeConcern`：（可选）抛出异常级别

下面就已删除 `email` 包含 `@gmail` 为例删除一条数据：

```
db.user_log.remove({email: /@gmail/}, {juestOne: true})
```

### 修改命令

修改命令与新增命令相同，都有修改单条、多条个复合指令，如下所示：

```
# 修改单条
db.<collection_name>.updateOne()

# 修改多条
db.<collection_name>.updateMany()

# 复合命令
db.<collection_name>.update()
```

三者之间的语法是相同的，下面就具体说下：

```
db.<collection_name>.update(
   {<query>},
   {<update>},
   {
     upsert: <boolean>,
     multi: <boolean>,
     writeConcern: <document>
   }
)
```

- `query`：查询条件
- `update`：修改数据
- `upsert`：（可选）如果要修改的数据不存在是否做新增操作
- `multi`：（可选）是否修改多条
- `writeConcern`：（可选）抛出异常级别

对于 `updateOne` 和 `updateMany` 而言，`upsert` 想想是可选的，下面来具体看下如何修改数据：

指令如下：

```
db.<collection_name>.update({},{$set: {}})
```

#### 修改单条

下面来修改名称（`name`）为 `李四` 的用户，修改为 `麻子`：

```
db.user_log.update({name: "李四"}, {$set: {name: "麻子"}})
```

在修改之前先看下数据：

```
{ "_id" : ObjectId("..."), "name" : "张三", "username" : "zhanssan" }
{ "_id" : ObjectId("..."), "name" : "张三", "username" : "zhanssan" }
{ "_id" : ObjectId("..."), "name" : "王二", "username" : "wanger" }
{ "_id" : ObjectId("..."), "name" : "李四", "username" : "lisi" }
{ "_id" : ObjectId("..."), "name" : "张三1", "username" : "zhanssan" }
{ "_id" : ObjectId("..."), "name" : "张三1", "username" : "zhanssan", "age" : 20 }
{ "_id" : ObjectId("..."), "name" : "张三2", "username" : "zhanssan", "age" : 22 }
```

再看下修改后的数据：

```
{ "_id" : ObjectId("..."), "name" : "张三", "username" : "zhanssan" }
{ "_id" : ObjectId("..."), "name" : "张三", "username" : "zhanssan" }
{ "_id" : ObjectId("..."), "name" : "王二", "username" : "wanger" }
{ "_id" : ObjectId("..."), "name" : "麻子", "username" : "lisi" }
{ "_id" : ObjectId("..."), "name" : "张三1", "username" : "zhanssan" }
{ "_id" : ObjectId("..."), "name" : "张三1", "username" : "zhanssan", "age" : 20 }
{ "_id" : ObjectId("..."), "name" : "张三2", "username" : "zhanssan", "age" : 22 }
```

看到，名字修改成功了。

#### 修改新增操作

现在继续修改一下修改语句如下：

```
db.user_log.update({name: "李四"}, {$set: {name: "麻子1"}}, {upsert: true})
```

这句命令是将 `李四` 修改为 `麻子`，如果在数据库中不存在则做新增操作！

命令执行后的数据如下：

```
{ "_id" : ObjectId("..."), "name" : "张三", "username" : "zhanssan" }
{ "_id" : ObjectId("..."), "name" : "张三", "username" : "zhanssan" }
{ "_id" : ObjectId("..."), "name" : "王二", "username" : "wanger" }
{ "_id" : ObjectId("..."), "name" : "麻子", "username" : "lisi" }
{ "_id" : ObjectId("..."), "name" : "张三1", "username" : "zhanssan" }
{ "_id" : ObjectId("..."), "name" : "张三1", "username" : "zhanssan", "age" : 20 }
{ "_id" : ObjectId("..."), "name" : "张三2", "username" : "zhanssan", "age" : 22 }
{ "_id" : ObjectId("..."), "name" : "麻子1" }
```

#### 批量修改

现在我们将所有名字包含 `张三` 的用户修改为 `MinGRn`，命令如下所示：

```
db.user_log.update({name: /张三/}, {$set: {name: "MinGRn"}}, {multi: true})
```

现在再来看下数据：

```
{ "_id" : ObjectId("..."), "name" : "MinGRn", "username" : "zhanssan" }
{ "_id" : ObjectId("..."), "name" : "MinGRn", "username" : "zhanssan" }
{ "_id" : ObjectId("..."), "name" : "王二", "username" : "wanger" }
{ "_id" : ObjectId("..."), "name" : "麻子", "username" : "lisi" }
{ "_id" : ObjectId("..."), "name" : "MinGRn", "username" : "zhanssan" }
{ "_id" : ObjectId("..."), "name" : "MinGRn", "username" : "zhanssan", "age" : 20 }
{ "_id" : ObjectId("..."), "name" : "MinGRn", "username" : "zhanssan", "age" : 22 }
{ "_id" : ObjectId("..."), "name" : "麻子1" }
```

另外，如果觉得这条修改指令比较繁琐你也可以替换成 `updateMany` 命令，如下所示：

```
db.user_log.updateMany({name: /张三/}, {$set: {name: "MinGRn"}})
```

